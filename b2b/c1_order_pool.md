# 1C_microservice_for_B2B

1C_microservice_for_B2B

# Оглавление

[0. Процесс обновления заказа](#L0)

[1. Получение информации об оформленных заказах в B2B](#L1)

[2. Обновление информации по заказам](#L2)

[3. Обновление информации по клиентам \*_в разработке_](#L3)

[4. Обновление информации по номенклатуре/товарам \*_в разработке_](#4)

<a id = "L0"></a>

## 0. Процесс обновления заказа

| Шаг № | Описание                            | Процесс                                                                   |
| ----- | ----------------------------------- | ------------------------------------------------------------------------- |
| 1     | [Получение списка заказов](#L1)     | Получение списка заказов, оформленных через b2b портал                    |
| 2     | [Отправка GUID кода в 1С](#L2.1)    | Отправить GUID коды сформированных заказов/потребностей                   |
| 3     | [Обновление данных в заказе](#L2.2) | Отправка обновленной информации о заказе, привязка цен, изменение статуса |

<a id = "L1"></a>

## 1. Получение информации об оформленных заказах в B2B

## Получение списка новых заказов, сформированных на b2b портале

Отправить `GET` запрос на `http://77.105.172.224:3100/api/c1/order_pool`

В ответ на данный запрос будет отправлен список заказов, которые были обновлены с последнего запроса

\*При первом обмене будут отправлены **_ВСЕ_** сформированные заказы\*

<a id = "get_order_pool_answer"></a>

Ответ в следующем формате:

```
[
    {
        "id": "id заказа в системе b2b",
        "OrderNo": 123 ,
        "GUID_1C": ""  ,
        "C1_code": "" ,
        "status":1,
        "User_id": "8bb6544d-de4a-4c0c-a734-b87faf41886e",
        "sum_wo_skid": null,
        "sum_skid": null,
        "sum_NDS": null,
        "sum": null,
        "User_info":
            {
                "C1_code": "УТ-00016879",
                "INN": "1513076409",
                "KPP": "0",
                "User_GUID": null
            },
        "content":[
            {
                "id":
                "qty":
                "spmatNo":
                "price": null,
                "price_wo_skid": null,
                "price_skid": null,
                "price_rate_NDS": "20",
                "price_sum_NDS": null,
                "price_sum": null
            },
                        {
                "id":
                "qty":
                "spmatNo":
                "price": null,
                "price_wo_skid": null,
                "price_skid": null,
                "price_rate_NDS": "20",
                "price_sum_NDS": null,
                "price_sum": null
            },
            ...                                     --> другие объекты товаров

        ]
    },

    ...                                             --> другие объекты сформированных заказов
]
```

**Параметры ответа**

| Параметр    | Тип             | Описание                                                             |
| ----------- | --------------- | -------------------------------------------------------------------- |
| id          | string          | id заказа на b2b портале                                             |
| OrderNo     | number          | Порядковый номер заказа на b2b портале                               |
| GUID_1C     | string          | GUID оформленного заказа в 1С - _если это новый заказ - будет null_  |
| C1_code     | string          | Код УТ оформленного заказа в 1С- _если это новый заказ - будет null_ |
| status      | number          | Статус заказа                                                        |
| User_info   | Object          | Информация о клиенте, сформировавшем заказ                           |
| content     | Array [Objects] | Массив товаров в заказе                                              |
| sum_wo_skid | number          | Итоговая Сумма заказа без скидки (в счете - "Сумма без скидки")      |
| sum_skid    | number          | Итоговая сумма скидки (в счете - "Скидка")                           |
| sum_NDS     | number          | Итоговая сумма НДС (в счете - "Сумма НДС")                           |
| sum         | number          | Итоговая сумма заказа (в счете - "Сумма")                            |

**Описание User_info|Object**

| Параметр  | Тип    | Описание                               |
| --------- | ------ | -------------------------------------- |
| C1_code   | string | Код клиента 1с (Пример "УТ - 0016879") |
| INN       | string | ИНН клиента                            |
| KPP       | string | КПП Клиента                            |
| User_GUID | string | GUID Клиента (default - null)          |

**Описание content|Array [Objects]**

| Параметр                        | Тип          | Описание                                              |
| ------------------------------- | ------------ | ----------------------------------------------------- |
| id                              | String, UUID | id товара в заказе                                    |
| qty                             | number       | количество spmatNo в заказе                           |
| spmatNo                         | string       | артикул товара                                        |
| _Цены в табличной части счета:_ |
| price                           | number       | Цена за товар (в счете - "Цена")                      |
| price_wo_skid                   | number       | Цена товара без скидки (в счете - "Сумма без скидки") |
| price_skid                      | number       | Цена скидки на товар (в счете - "Скидка")             |
| price_rate_NDS                  | number       | Ставка НДС - default - 20%(в счте - "Ставка НДС")     |
| price_sum_NDS                   | number       | НДС на товар (в счете - "Сумма НДС")                  |
| price_sum                       | number       | Цена итоговая на товар (в счете - "Сумма")            |

## 1.1 Получение закзов по параметру даты

Для получения заказов, сформированных в b2b портале за определенный период, отправьте запрос
`GET` на `http://77.105.172.224:3100/api/c1/order_pool` с параметром даты `?date=MM-DD-YYYY`

В ответ будет отправлен список заказов, сформированных за данный день [формат ответа](#get_order_pool_answer)

_Пример: `http://77.105.172.224:8000/api1c/order_pool?date=10-03-2025`_

## 1.2 Получение закзов по параметру GUID 1c

Для получения заказа по GUID коду 1с отправьте запрос
`GET` на `http://77.105.172.224:3100/api/c1/order_pool` с параметром даты `?GUID_1C=example`

В ответ будет отправлен массив с одним заказом, соответсвующему данному GUID коду [формат ответа](#get_order_pool_answer)

_Пример: `http://77.105.172.224:3100/api/c1/order_pool?GUID_1C=12`_

<a id = "L2"></a>

## 2. Обновление информации по заказам

### 2.0 Основная информация

После получения списка заказов необходимо отправить GUID коды, так как дальнейшее запросы на обновление данных в заказе будет проводиться по GUID коду заказа в 1с.

<a id = "L2.1"></a>

### 2.1 Привязка GUID заказа 1С к заказу B2B портала

Для привязки заказа b2b портала к 1с - необходимо отправить запрос
`POST` на `http://77.105.172.224:3100/api/c1/order_pool`
в body запроса укажите массив в следующем формате:

```
[
  {
      "id": "f0fa3a5c-4034-4d5a-bd17-6dcf7a30aba9"
      "GUID_1C": "d825f77c-59ac-411d-b09e-6cd7b0d56092"
      "C1_code":"УТ-123141"
  },
      {
      "id": ""
      "GUID_1C": ""
      "C1_code":""
  },
  ...
]

```

**Параметры запроса**

| Параметр | Тип    | Описание                        | Обязательность |
| -------- | ------ | ------------------------------- | -------------- |
| id       | string | id заказа b2b из ответа         | +              |
| GUID_1C  | string | GUID оформленного заказа в 1С   | +              |
| C1_code  | string | Код УТ оформленного заказа в 1С | -              |

**Пример ответа:**

```
[
    {
        "status": 200,
        "msg": "Success"
    },
        {
        "status": 400,
        "msg": "Wrong parameters",
        "parameters": [
            "nu123ll",
            false,
            "2025-03-12 11:58:55.741 +00:00",
            "646f698c-a2-4b61-8326-debe44cd9413"
        ]
    },
    ...
]
```

**Параметры Ответа**

| Параметр   | Тип              | Описание                                                        |
| ---------- | ---------------- | --------------------------------------------------------------- |
| status     | number (200/400) | 200 - привязка произведена успешно, 400 - привязка не прописана |
| msg        | string           | сообщение об шибке                                              |
| parameters | string           | возвращает массив полей из запроса с ошибкой                    |

<a id = "L2.2"></a>

### 2.2 Обновлнение информации в заказе

Используется для привязки цен на товары из 1с к заказу 1с
Отправьте `POST` запрос на `http://77.105.172.224:3100/api/c1/order_pool`
в body запроса укажите массив в следующем формате

```
[
    {
        "GUID_1C" : "d825f77c-59ac-411d-b09e-6cd7b0d56092"
        "status" : 1,
        "User_info":
        "SumPriceNDS": 12321.123
        "SumPrice_NDS" : 12321.123
        "SumPrice_wo_NDS" : 12321.123
        {
            "Cli_GUID_1C" :          ""
            "Cli_INN" :              ""
            "Cli_KPP" :              ""
            "Cli_1C_code" :          ""
            "Cli_contract_GUID_1C":  ""
        },
        "content" : [
            {
                "qty":               1
                "spmatNo":           "123.231.123.123"
                "price":             null
                "sumPrice":
            },
                        {
                "qty":
                "spmatNo":
                "price":
                "sumPrice":
            },
            ...                        --> другие объекты товаров

        ]
    },

    ...                                --> другие объекты сформированных заказов
]
```

**Параметры запроса**

| Параметр        | Тип             | Описание                                               | Обязательность |
| --------------- | --------------- | ------------------------------------------------------ | -------------- |
| GUID_1C         | string          | GUID оформленного заказа в 1С                          | +              |
| C1_code         | string          | Код УТ оформленного заказа в 1С                        | -              |
| status          | number          | [Статус заказа](#order_stats)                          | +              |
| User_info       | Object          | Информация о клиенте, сформировавшем заказ             | -              |
| content         | Array [Objects] | [Массив товаров в заказе](#contet_obj)                 | +              |
| SumPriceNDS     | decimal         | Сумма заказа с НДС                                     | +              |
| SumPrice_NDS    | decimal         | Сумма НДС в закакзе (20% от от поля "SumPrice-wo-NDS") | +              |
| SumPrice_wo_NDS | decimal         | Сумма заказа без НДС                                   | +              |

<a id="order_stats"></a>
**Кодировки статусов - параметр status**

| Номер | Название                     | Описание                                                                                                                           | Система присвоения |
| ----- | ---------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| 1     | Заказ сформирован в b2b      | Первичный статус заказа при формировании клиентом                                                                                  | B2B                |
| 2     | Заказ одобрен АСЦ Менеджером | Заказ одобрен сотрудником Интерскол в B2B - данный заказ попадет в список заказов на выгрузку в 1С [Получение списка заказов](#L1) | B2B                |
| 3     | Заказ сформирован в 1С       | Автоматически присваивается при привязке GUID кода к заказу                                                                        | 1С -> B2B          |
| 4     | Присвоена цена в заказе B2B  | Обвлена информация по ценам заказа присваивается в случае, когда у всех товаров присвена цена                                      | 1C->B2B            |
| 5     | Заказ оплачен                | Присваивается в случае проведения оплаты по заказу в 1С                                                                            | 1С                 |
| 6     | Заказ в сборке               | Присваивается после отправки заказ в систему скалада                                                                               | 1С                 |
| 7     | Заказ отправлен              | Присваивается после передачи заказа в транспортную компанию                                                                        | 1C                 |
| 8     | Заказ получен                | Присваивается после получения заказа клиентом                                                                                      | 1C                 |

<a id="contet_obj"></a>
**Описание content-object|Array [Objects]**

| Параметр | Тип     | Описание                                             | Обязательность |
| -------- | ------- | ---------------------------------------------------- | -------------- |
| qty      | number  | количество spmatNo в заказе                          | -              |
| spmatNo  | string  | артикул товара                                       | +              |
| price    | decimal | цена 1с товара за 1 одиницу в заказе                 | +              |
| sumPrice | decimal | сумма по цене за все артикула (по факту qty х price) | +              |

NDS
-NDS
-wo

<a id = "L3"></a>

## 3. Обновление информации по клиентам \*_в разработке_

<a id = "L4"></a>

## 4. Обновление информации по номенклатуре \*_в разработке_
