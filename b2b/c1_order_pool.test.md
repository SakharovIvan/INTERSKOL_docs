# 1C_microservice_for_B2B

Тестовая база данных со спском заказов B2B портала

# Оглавление

[0. Процесс обновления заказа](#L0)

[1. Получение информации об оформленных заказах в B2B](#L1)

[2. Обновление информации по заказам](#L2)

[3. Обновление информации по клиентам \*_в разработке_](#L3)

[4. Обновление информации по номенклатуре/товарам \*_в разработке_](#4)

<a id = "L0"></a>

## 0. Процесс обновления заказа

| Шаг № | Описание                            | Процесс                                                                   |
| ----- | ----------------------------------- | ------------------------------------------------------------------------- |
| 1     | [Получение списка заказов](#L1)     | Получение списка заказов, оформленных через b2b портал                    |
| 2     | [Отправка GUID кода в 1С](#L2.1)    | Отправить GUID коды сформированных заказов/потребностей                   |
| 3     | [Обновление данных в заказе](#L2.2) | Отправка обновленной информации о заказе, привязка цен, изменение статуса |
| 4\*   | [Очищение списка заказов](#L2.3)    | Только для тестов!!! обнуление списка заказов                             |

<a id = "L1"></a>

## 1. Получение информации об оформленных заказах в B2B

## Получение списка новых заказов, сформированных на b2b портале

Отправить `GET` запрос на `http://77.105.172.224:3100/api/order/c1/test/order_pool`

В ответ на данный запрос будет отправлен список заказов, которые были обновлены с последнего запроса

<a id = "get_order_pool_answer"></a>

Ответ в следующем формате:

```
[
    {
        "id": "4c4a77ed-4eb7-45f4-b66c-c81dc809c9c4",
        "OrderNo": 63,
        "B2b_id": "935aa089-5555-4bde-aad4-c4a7398c31b9",
        "UPD_param": false,
        "GUID_1C": "",
        "C1_code": null,
        "status": null,
        "User_id": "0d9ca6a9-d325-47c3-94e4-57ba8a3fa859",
        "sum_wo_skid": "0",
        "sum_skid": "0",
        "sum_NDS": "0",
        "sum": "0",
        "SumPriceNDS": "0",
        "SumPrice_NDS": "0",
        "SumPrice_wo_NDS": "0",
        "createdAt": "2025-04-02T22:24:41.760Z",
        "updatedAt": "2025-04-02T22:24:41.760Z",

        "UserInfo": {
            "gis_code": 5,
            "C1_code": "УТ-00012771",
            "organization_name": "ИП Мингалёв Александр Викторович",
            "Indeks": "450054",
            "addres": "пр-кт Октября, д.56/1",
            "Tlf": "+7 (347) 246-31-86",
            "email": "service@mechanic-ufa.ru; Stanislav@mechanic-ufa.ru; ludmila@mechanic-ufa.ru;",
            "Raschet_schet_bank": "40802810700010000124",
            "Korr_schet_bank": "30101810600000000770",
            "BIK_bank": "048073770",
            "Name_bank": "ФИЛИАЛ ПАО \"БАНК УРАЛСИБ\" В Г-УФА",
            "OKPO": "0082619484",
            "email_2": "service@mechanic-ufa.ru; Stanislav@mechanic-ufa.ru; ludmila@mechanic-ufa.ru;",
            "skid": 45,
            "contract_DSO": "50/24/ДСО",
            "contract_DSO_date": "18-03-2024",
            "contract_shipment": "NULL",
            "contract_shipment_date": "NULL",
            "DSO_region": 2,
            "CliInfo_ID": "2a412650-1d95-4b85-a0d7-8c82e39ac498",
            "KPP": "0",
            "organization_INN": "020701207214",
            "id": "bd1065ea-74fe-4ee1-accb-9fd4b3b274eb",
            "createdAt": "Fri Mar 21 2025 10:24:26 GMT+0000 (Coordinated Universal Time)"
        },
        "products":[
            {
                "id": "5d1dd2d8-6c61-4138-b500-4e20ee394627",
                "spmatNo": "00.01.01.01.65",
                "qty": 5,
                "price": "0",
                "orderid": "4c4a77ed-4eb7-45f4-b66c-c81dc809c9c4",
                "price_wo_skid": "0",
                "price_skid": "0",
                "price_rate_NDS": "0",
                "price_sum_NDS": "0",
                "price_sum": "0",
                "createdAt": "2025-04-02T22:09:58.431Z",
                "updatedAt": "2025-04-02T22:24:42.029Z"
            },
            {
                "id": "eaeb109a-8bf8-4988-a10c-5730d40145ef",
                "spmatNo": "00.02.04.01.35",
                "qty": 5,
                "price": "0",
                "orderid": "4c4a77ed-4eb7-45f4-b66c-c81dc809c9c4",
                "price_wo_skid": "0",
                "price_skid": "0",
                "price_rate_NDS": "0",
                "price_sum_NDS": "0",
                "price_sum": "0",
                "createdAt": "2025-04-02T21:13:30.402Z",
                "updatedAt": "2025-04-02T22:24:42.036Z"
            },
            ...                                     --> другие объекты товаров

        ]
    },

    ...                                             --> другие объекты сформированных заказов
]
```

**Параметры ответа**

| Параметр        | Тип    | Описание                                                             |
| --------------- | ------ | -------------------------------------------------------------------- |
| id              | string | id заказа на b2b портале                                             |
| OrderNo         | number |                                                                      |
| B2b_id          |        |                                                                      |
| UPD_param       |        |                                                                      |
| GUID_1C         | string | GUID оформленного заказа в 1С - _если это новый заказ - будет null_  |
| C1_code         | string | Код УТ оформленного заказа в 1С- _если это новый заказ - будет null_ |
| status          | number | Статус заказа                                                        |
| User_id         |        |                                                                      |
| sum_wo_skid     | number | Итоговая Сумма заказа без скидки (в счете - "Сумма без скидки")      |
| sum_skid        | number | Итоговая сумма скидки (в счете - "Скидка")                           |
| sum_NDS         | number | Итоговая сумма НДС (в счете - "Сумма НДС")                           |
| sum             | number | Итоговая сумма заказа (в счете - "Сумма")                            |
| SumPriceNDS     | number | Итоговая сумма НДС                                                   |
| SumPrice_NDS    | number | Итоговая сумма                                                       |
| SumPrice_wo_NDS | number | Итоговая сумма без НДС                                               |
| createdAt       | Date   | Дата создания                                                        |
| updatedAt       | Date   | Дата обновления заказа                                               |

**Описание User_info|Object**

| Параметр               | Тип    | Описание                               |
| ---------------------- | ------ | -------------------------------------- |
| gis_code               | number | Код ГИС                                |
| C1_code                | string | Код клиента 1с (Пример "УТ - 0016879") |
| organization_name      | string | Наименование Организации               |
| Indeks                 | string | Индекс                                 |
| addres                 | string | Адрес организации                      |
| Tlf                    | string | Телефон клиента                        |
| email                  | string | email клиента                          |
| Raschet_schet_bank     | string | Расчетный счет клиента                 |
| Korr_schet_bank        | string | Корр счет клиента                      |
| BIK_bank               | string | БИК банка клиента                      |
| Name_bank              | string | Наименовнаие банка                     |
| OKPO                   | string | ОКПО банка                             |
| email_2                | string | email_2 клиента                        |
| skid                   | number | Скидка клиента на товары               |
| contract_DSO           | string | Наимновнаие контракта ДСО              |
| contract_DSO_date      | string | Дата контракта ДСО                     |
| contract_shipment      | string | Наименование договора на доставку      |
| contract_shipment_date | string | Дата договора на доставку              |
| DSO_region             | number | Регион ДСО из ГИС                      |
| CliInfo_ID             | string | id клиента                             |
| KPP                    | string | КПП код клиента                        |
| organization_INN       | string | ИНН организации                        |

**Описание content|Array [Objects]**

| Параметр                        | Тип          | Описание                                              |
| ------------------------------- | ------------ | ----------------------------------------------------- |
| id                              | String, UUID | id товара в заказе                                    |
| spmatNo                         | string       | артикул товара                                        |
| qty                             | number       | количество spmatNo в заказе                           |
| _Цены в табличной части счета:_ |
| price                           | number       | Цена за товар (в счете - "Цена")                      |
| price_wo_skid                   | number       | Цена товара без скидки (в счете - "Сумма без скидки") |
| price_skid                      | number       | Цена скидки на товар (в счете - "Скидка")             |
| price_rate_NDS                  | number       | Ставка НДС - default - 20%(в счте - "Ставка НДС")     |
| price_sum_NDS                   | number       | НДС на товар (в счете - "Сумма НДС")                  |
| price_sum                       | number       | Цена итоговая на товар (в счете - "Сумма")            |
| orderid                         | String, UUID | id заказа в b2b портале                               |
| createdAt                       | Date         | Дата создания                                         |
| updatedAt                       | Date         | Дата обновления заказа                                |

## 1.2 Получение закзов по параметру GUID 1c

Для получения заказа по GUID коду 1с отправьте запрос
`GET` на `http://77.105.172.224:3100/api/order/c1/test/order_pool` с параметром даты `?GUID_1C=example`

В ответ будет отправлен массив с одним заказом, соответсвующему данному GUID коду [формат ответа](#get_order_pool_answer)

_Пример: `http://77.105.172.224:3100/api/order/c1/test/order_pool?GUID_1C=12`_

<a id = "L2"></a>

## 2. Обновление информации по заказам

### 2.0 Основная информация

После получения списка заказов необходимо отправить GUID коды, так как дальнейшее запросы на обновление данных в заказе будет проводиться по GUID коду заказа в 1с.

<a id = "L2.1"></a>

### 2.1 Привязка GUID заказа 1С к заказу B2B портала

Для привязки заказа b2b портала к 1с - необходимо отправить запрос
`POST` на `http://77.105.172.224:3100/api/order/c1/test/order_pool`
в body запроса укажите массив в следующем формате:

```
[
  {
      "id": "f0fa3a5c-4034-4d5a-bd17-6dcf7a30aba9"
      "GUID_1C": "d825f77c-59ac-411d-b09e-6cd7b0d56092"
      "C1_code":"УТ-123141"
  },
      {
      "id": ""
      "GUID_1C": ""
      "C1_code":""
  },
  ...
]

```

**Параметры запроса**

| Параметр | Тип    | Описание                        | Обязательность |
| -------- | ------ | ------------------------------- | -------------- |
| id       | string | id заказа b2b из ответа         | +              |
| GUID_1C  | string | GUID оформленного заказа в 1С   | +              |
| C1_code  | string | Код УТ оформленного заказа в 1С | -              |

**Пример ответа:**

```
[
    {
        "status": 200,
        "msg": "Success"
    },
        {
        "status": 400,
        "msg": "Wrong parameters",
        "parameters": [
            "nu123ll",
            false,
            "2025-03-12 11:58:55.741 +00:00",
            "646f698c-a2-4b61-8326-debe44cd9413"
        ]
    },
    ...
]
```

**Параметры Ответа**

| Параметр   | Тип              | Описание                                                        |
| ---------- | ---------------- | --------------------------------------------------------------- |
| status     | number (200/400) | 200 - привязка произведена успешно, 400 - привязка не прописана |
| msg        | string           | сообщение об шибке                                              |
| parameters | string           | возвращает массив полей из запроса с ошибкой                    |

<a id = "L2.2"></a>

### 2.2 Обновлнение информации в заказе

Используется для привязки цен на товары из 1с к заказу 1с
Отправьте `POST` запрос на `http://77.105.172.224:3100/api/order/c1/test/order_pool`
в body запроса укажите массив в следующем формате
Обновление в Базе данных происходит только по парамету id заказа, либо по GUID_1C, переданный ранее.

```
[
    {
        "id": "4c4a77ed-4eb7-45f4-b66c-c81dc809c9c4",
        "GUID_1C": "УТ",
        "C1_code": "фывй123",
        "status": null,
        "sum_wo_skid": "23123",
        "sum_skid": "0",
        "sum_NDS": "0",
        "sum": "0",
        "SumPriceNDS": "0",
        "SumPrice_NDS": "0",
        "SumPrice_wo_NDS": "0",
        "content": [
            {
                "spmatNo": "00.01.01.01.65",
                "qty": 5,
                "price": "1230.12",
                "price_wo_skid": "0",
                "price_skid": "0",
                "price_rate_NDS": "0",
                "price_sum_NDS": "0",
                "price_sum": "0"
            }
            ,
            ...                        --> другие объекты товаров

        ]
    },

    ...                                --> другие объекты сформированных заказов
]
```

**Параметры запроса**

| Параметр                        | Тип             | Описание                                                        | Обязательность |
| ------------------------------- | --------------- | --------------------------------------------------------------- | -------------- |
| GUID_1C                         | string          | GUID оформленного заказа в 1С                                   | +              |
| C1_code                         | string          | Код УТ оформленного заказа в 1С                                 | -              |
| status                          | number          | [Статус заказа](#order_stats)                                   | +              |
| User_info                       | Object          | Информация о клиенте, сформировавшем заказ                      | -              |
| content                         | Array [Objects] | [Массив товаров в заказе](#contet_obj)                          | +              |
| id                              | string          | id заказа b2b из ответа                                         | +              |
| GUID_1C                         | string          | GUID оформленного заказа в 1С                                   | +              |
| C1_code                         | string          | Код УТ оформленного заказа в 1С                                 | -              |
| status                          | number          | [Статус заказа](#order_stats)                                   | +              |
|                                 |
| _Цены в табличной части счета:_ |
| sum_wo_skid                     | number          | Итоговая Сумма заказа без скидки (в счете - "Сумма без скидки") |
| sum_skid                        | number          | Итоговая сумма скидки (в счете - "Скидка")                      |
| sum_NDS                         | number          | Итоговая сумма НДС (в счете - "Сумма НДС")                      |
| sum                             | number          | Итоговая сумма заказа (в счете - "Сумма")                       |
| SumPriceNDS                     | number          | Итоговая сумма НДС                                              |
| SumPrice_NDS                    | number          | Итоговая сумма                                                  |
| SumPrice_wo_NDS                 | number          | Итоговая сумма без НДС                                          |

<a id="order_stats"></a>
**Кодировки статусов - параметр status**

| Номер | Название                     | Описание                                                                                                                           | Система присвоения |
| ----- | ---------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| 1     | Заказ сформирован в b2b      | Первичный статус заказа при формировании клиентом                                                                                  | B2B                |
| 2     | Заказ одобрен АСЦ Менеджером | Заказ одобрен сотрудником Интерскол в B2B - данный заказ попадет в список заказов на выгрузку в 1С [Получение списка заказов](#L1) | B2B                |
| 3     | Заказ сформирован в 1С       | Автоматически присваивается при привязке GUID кода к заказу                                                                        | 1С -> B2B          |
| 4     | Присвоена цена в заказе B2B  | Обвлена информация по ценам заказа присваивается в случае, когда у всех товаров присвена цена                                      | 1C->B2B            |
| 5     | Заказ оплачен                | Присваивается в случае проведения оплаты по заказу в 1С                                                                            | 1С                 |
| 6     | Заказ в сборке               | Присваивается после отправки заказ в систему скалада                                                                               | 1С                 |
| 7     | Заказ отправлен              | Присваивается после передачи заказа в транспортную компанию                                                                        | 1C                 |
| 8     | Заказ получен                | Присваивается после получения заказа клиентом                                                                                      | 1C                 |

<a id="contet_obj"></a>
**Описание content-object|Array [Objects]**

| Параметр       | Тип    | Описание                                              | Обязательность |
| -------------- | ------ | ----------------------------------------------------- | -------------- |
| qty            | number | количество spmatNo в заказе                           | -              |
| spmatNo        | string | артикул товара                                        | +              |
| price          | number | цена 1с товара за 1 одиницу в заказе                  | +              |
| price_wo_skid  | number | Цена товара без скидки (в счете - "Сумма без скидки") |
| price_skid     | number | Цена скидки на товар (в счете - "Скидка")             |
| price_rate_NDS | number | Ставка НДС - default - 20%(в счте - "Ставка НДС")     |
| price_sum_NDS  | number | НДС на товар (в счете - "Сумма НДС")                  |
| price_sum      | number | Цена итоговая на товар (в счете - "Сумма")            |

<a id = "L2.3"></a>

### 2.3 Очищение списка заказов

Для очищения списка заказов и создания нового списка не отгруженных заказов:
`GET` на `http://77.105.172.224:3100/api/order/c1/test/order_pool/clear`

После отправки данной команды будут перерасчитаны все цены в заказах и продуктах заказов.

Все данные по GUID_1C будут заменены на null или пустое значение

Будет сформирован новый список заказов для отгрузки

<a id = "L3"></a>

## 3. Обновление информации по клиентам \*_в разработке_

<a id = "L4"></a>

## 4. Обновление информации по номенклатуре \*_в разработке_
